"use strict";(function(){var t=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.isObject=function(e){return"object"===t(e)},this.isFunction=function(e){return"function"===t(e)},this.isRegexp=function(e){return"regexp"===t(e)},this.isArguments=function(e){return"arguments"===t(e)},this.isError=function(e){return"error"===t(e)},this.isArray=function(e){return"array"===t(e)},this.isDate=function(e){return"date"===t(e)},this.isString=function(e){return"string"===t(e)},this.isNumber=function(e){return"number"===t(e)},this.isBoolean=function(e){return"boolean"===t(e)},this.isElement=function(t){return t&&1===t.nodeType},this.getType=t}).call(window||{}),function(){var t="1.0.0",e={},n={};this.$checkout=function(t,e){return n[t]?n[t]:n[t]=this.get(t,e||{})},this.$checkout.get=function(t,n){if(!e[t])throw Error("module is undefined");return new e[t](n||{})},this.$checkout.module=function(t){if(!e[t])throw Error("module is undefined");return e[t]},this.$checkout.proxy=function(t){if(!e[t])throw Error("module is undefined");return e[t].apply(this,Array.prototype.slice.call(arguments,1))},this.$checkout.add=function(t,n){if(e[t])throw Error("module already added");e[t]=n},this.$checkout.version=function(e){return t=e,this},this.$checkout._debug_=Number(document.cookie.replace(/(?:(?:^|.*;\s*)checkout_debug\s*\=\s*([^;]*).*$)|^.*$/,"$1")),this.$checkout.debug=function(t){document.cookie=["checkout_debug",Number(t)].join("=")},this.$checkout.log=function(){this._debug_&&"console"in window&&console.log.apply(console,arguments)},this.$checkout.factory=function(t,e){this.add(t,e(this))}}.call(window||{}),$checkout.factory("removeElement",function(){return function(t){t.parentNode.removeChild(t)}}),$checkout.factory("addEvent",function(){return function(t,e,n){if(!t)return!1;t.addEventListener?t.addEventListener(e,n):t.attachEvent&&t.attachEvent("on"+e,n)}}),$checkout.factory("popupBlocker",function(t){return function(t){var e=!1;try{e=void 0===t||(!t||!t.closed)&&(!t||!t.test)}catch(t){}return e}}),$checkout.factory("Class",function(t){var e=!1,n=/xyz/.test(function(){return"xyz"}.toString())?/\b_super\b/:/.*/,i=function(){};return i.prototype={instance:function(t){return new this.constructor(t)},proxy:function(t){return t="string"==typeof t?this[t]:t,function(t,e){return function(){return e.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}}(this,t)}},i.extend=function(t,i){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r,s,c=this.prototype,a=o.extend;e=!0,s=new this,e=!1;for(r in t)t.hasOwnProperty(r)&&("function"==typeof c[r]&&"function"==typeof t[r]&&n.test(t[r])?s[r]=function(t,e){return function(){var n,i=this._super;return this._super=c[t],n=e.apply(this,arguments),this._super=i,n}}(r,t[r]):s[r]=t[r]);return o.prototype=s,o.prototype.name=i,o.prototype.constructor=o,o.extend=a,o},i}),$checkout.factory("Deferred",function(t){function e(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t,n){if(e(t))for(var i=0;i<t.length;i++)n(t[i]);else n(t)}function i(t){var o="pending",r=[],s=[],c=[],a=null,u={done:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"resolved"===o&&n[i].apply(this,a),r.push(n[i]);else"resolved"===o&&arguments[t].apply(this,a),r.push(arguments[t]);return this},fail:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"rejected"===o&&n[i].apply(this,a),s.push(n[i]);else"rejected"===o&&arguments[t].apply(this,a),s.push(arguments[t]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"pending"===o&&c.push(n[i]);else"pending"===o&&c.push(arguments[t]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(t){if(null===t)return u;for(var e in u)t[e]=u[e];return t},state:function(){return o},debug:function(){console.log("[debug]",r,s,o)},isRejected:function(){return"rejected"===o},isResolved:function(){return"resolved"===o},pipe:function(t,e,o){return i(function(i){n(t,function(t){"function"==typeof t?h.done(function(){var e=t.apply(this,arguments);e&&"function"==typeof e?e.promise().then(i.resolve,i.reject,i.notify):i.resolve(e)}):h.done(i.resolve)}),n(e,function(t){"function"==typeof t?h.fail(function(){var e=t.apply(this,arguments);e&&"function"==typeof e?e.promise().then(i.resolve,i.reject,i.notify):i.reject(e)}):h.fail(i.reject)})}).promise()}},h={resolveWith:function(t){if("pending"===o){o="resolved";for(var e=a=arguments.length>1?arguments[1]:[],n=0;n<r.length;n++)r[n].apply(t,e)}return this},rejectWith:function(t){if("pending"===o){o="rejected";for(var e=a=arguments.length>1?arguments[1]:[],n=0;n<s.length;n++)s[n].apply(t,e)}return this},notifyWith:function(t){if("pending"===o)for(var e=a=arguments.length>1?arguments[1]:[],n=0;n<c.length;n++)c[n].apply(t,e);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},d=u.promise(h);return isFunction(t)&&t.apply(d,[d]),d}return i.when=function(){if(arguments.length<2){var t=arguments.length?arguments[0]:void 0;return t&&"function"==typeof t.isResolved&&"function"==typeof t.isRejected?t.promise():i().resolve(t).promise()}return function(t){for(var e=i(),n=t.length,o=0,r=new Array(n),s=0;s<t.length;s++)!function(i){var s=null;t[i].done?t[i].done(function(){r[i]=arguments.length<2?arguments[0]:arguments,++o==n&&e.resolve.apply(e,r)}).fail(function(){e.reject(arguments)}):(s=t[i],t[i]=new Deferred,t[i].done(function(){r[i]=arguments.length<2?arguments[0]:arguments,++o==n&&e.resolve.apply(e,r)}).fail(function(){e.reject(arguments)}).resolve(s))}(s);return e.promise()}(arguments)},i}),$checkout.factory("Event",function(t){return t.module("Class").extend({init:function(){this.events={},this.empty=[]},on:function(t,e){return(this.events[t]=this.events[t]||[]).push(e),this},off:function(t,e){t||(this.events={});for(var n=this.events[t]||this.empty,i=n.length=e?n.length:0;i--;)e===n[i][0]&&n.splice(i,1);return this},trigger:function(t){for(var e,n=this.events[t]||this.empty,i=n.length>0?n.slice(0,n.length):n,o=0;e=i[o++];)e.apply(e,this.empty.slice.call(arguments,1));return this}})}),$checkout.factory("Connector",function(t){return t.module("Class").extend({ns:"crossDomain",origin:"*",uniqueId:1,init:function(t){this.setTarget(t.target),this.create()},create:function(){this.listener=t.get("Event"),t.proxy("addEvent",window,"message",this.proxy("router"))},setTarget:function(t){return this.target=t,this},getUID:function(){return++this.uniqueId},unbind:function(t,e){this.listener.off([this.ns,t].join("."),e)},action:function(t,e){this.listener.on([this.ns,t].join("."),e)},publish:function(t,e){this.listener.trigger([this.ns,t].join("."),e)},router:function(t,e,n){try{n=JSON.parse(e.data)}catch(t){}n.action&&n.data&&this.publish(n.action,n.data)},send:function(t,e){this.target.postMessage(JSON.stringify({action:t,data:e}),this.origin,[])}})}),$checkout.factory("AcsFrame",function(t){return t.module("Class").extend({name:"acsframe",attrs:{frameborder:"0",allowtransparency:"true",scrolling:"no"},styles:{zIndex:"9999",overflowX:"hidden",border:"0",display:"block",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"750px"},init:function(e){this.checkout=e.checkout,this.data=e.data,this.template=t.views["3ds.html"],this.initModal(),this.initEvents(),this.initFrame(),this.initConnector()},initFrame:function(){this.name=[this.name,Math.round(1e9*Math.random())].join(""),this.wrapper=this.find(".ipsp-modal-content"),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("name",this.name),this.iframe.setAttribute("id",this.name),this.iframe.className="ipsp-modal-iframe",this.addAttr(this.iframe,this.attrs),this.addCss(this.iframe,this.styles),this.form=this.prepareForm(this.data.url,this.data.send_data,this.name),this.wrapper.appendChild(this.iframe),this.wrapper.appendChild(this.form),this.form.submit()},initModal:function(){this.modal=document.createElement("div"),this.modal.innerHTML=this.template,document.querySelector("body").appendChild(this.modal)},find:function(t){return this.modal.querySelector(t)},initEvents:function(){var e=this.find(".ipsp-modal-close"),n=this.find(".ipsp-modal-title a");t.proxy("addEvent",e,"click",this.proxy(function(t,e){e.preventDefault(),this.removeModal()})),t.proxy("addEvent",n,"click",this.proxy(function(t,e){e.preventDefault(),this.form.submit()}))},removeModal:function(){t.proxy("removeElement",this.modal)},prepareForm:function(t,e,n,i){var o,r=document.createElement("form");r.action=t,r.target=n||"_self",r.method=i||"POST";for(var s in e)e.hasOwnProperty(s)&&((o=document.createElement("input")).type="hidden",o.name=s,o.value=e[s],r.appendChild(o));return r.style.display="none",r},initConnector:function(){this.connector=t.get("Connector"),this.connector.action("response",this.proxy(function(t,e){this.connector.unbind("response"),this.checkout.connector.send("request",{uid:e.uid,action:"api.checkout.proxy",method:"send",params:e}),this.removeModal()},this))},addCss:function(t,e){if(!t)return!1;for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},addAttr:function(t,e){var n;if(!t)return!1;for(n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}})}),$checkout.factory("Api",function(t){return t.module("Class").extend({origin:"https://api.dev.fondy.eu",endpoint:{gateway:"/checkout/"},init:function(){this.loaded=!1,this.created=!1,this.listener=t.get("Event"),this.connector=t.get("Connector"),this.params={}},url:function(t,e){return[this.origin,this.endpoint[t]||"/",e||""].join("")},loadFrame:function(t){return this.iframe=document.createElement("iframe"),this.iframe.src=t,this.iframe.style.display="none",document.getElementsByTagName("body")[0].appendChild(this.iframe),this.iframe},create:function(){return!1===this.created&&(this.created=!0,this.iframe=this.loadFrame(this.url("gateway")),this.connector.setTarget(this.iframe.contentWindow),this.connector.action("load",this.proxy("load")),this.connector.action("form3ds",this.proxy("form3ds"))),this},form3ds:function(e,n){this.acsframe=t.get("AcsFrame",{checkout:this,data:n})},load:function(){this.loaded=!0,this.listener.trigger("checkout.api"),this.listener.off("checkout.api")},scope:function(t){t=this.proxy(t),!0===this.create().loaded?t():this.listener.on("checkout.api",t)},defer:function(){return t.get("Deferred")},request:function(t,e,n){var i=this.defer(),o={};return o.uid=this.connector.getUID(),o.action=t,o.method=e,o.params=n||{},this.connector.send("request",o),this.connector.action(o.uid,this.proxy(function(t,e){i[e.error?"rejectWith":"resolveWith"](this,[e])},this)),i}})}),$checkout.views=Object.create(null),$checkout.views["3ds.html"]='<style>\n    .ipsp-modal-show{\n        overflow:hidden;\n    }\n    .ipsp-modal{\n        margin:100px auto;\n        max-width:680px;\n        background-color:#fff;\n        border-radius:5px;\n        box-shadow:0px 2px 2px rgba(0,0,0,0.2);\n        overflow: hidden;\n    }\n    @media (max-width:850px){\n        .ipsp-modal{\n            margin:50px auto;\n        }\n    }\n    @media (max-width:695px){\n        .ipsp-modal{\n            max-width:100%;\n            margin:5px;\n        }\n    }\n    .ipsp-modal-wrapper{\n        overflow: auto;\n        position:fixed;\n        z-index:99999;\n        left:0;\n        bottom:0;\n        top:0;\n        right:0;\n        background-color: rgba(0,0,0,0.2);\n    }\n    .ipsp-modal-header{\n        background-color:#fafafa;\n        height:50px;\n        box-shadow:0px 0px 2px rgba(0,0,0,0.2);\n        border-top-left-radius:5px;\n        border-top-right-radius:5px;\n    }\n    .ipsp-modal-close{\n        float:right;\n        overflow:hidden;\n        height:50px;\n        text-decoration:none;\n        border-top-right-radius:5px;\n        color:#949494;\n    }\n    .ipsp-modal-close:hover,.ipsp-modal-close:focus,.ipsp-modal-close:active{\n        text-decoration:none;\n        color:#646464;\n    }\n    .ipsp-modal-close:before{\n        content:"×";\n        font-size:50px;\n        line-height:45px;\n        padding:0 10px;\n    }\n    .ipsp-modal-title{\n        border-top-left-radius:5px;\n        line-height:20px;\n        height:50px;\n        padding:5px 15px;\n        font-size:12px;\n        display:table-cell;\n        vertical-align: middle;\n    }\n    .ipsp-modal-content{\n        border-bottom-left-radius:5px;\n        border-bottom-left-radius:5px;\n        min-height:650px;\n    }\n</style>\n<div class="ipsp-modal-wrapper">\n    <div class="ipsp-modal">\n        <div class="ipsp-modal-header">\n            <a href="#" class="ipsp-modal-close"></a>\n            <div class="ipsp-modal-title">\n                Now you will be redirected to your bank 3DSecure.\n                If you are not redirected please refer\n                <a href=\'javascript:void(0)\'>link</a>\n            </div>\n        </div>\n        <div class="ipsp-modal-content">\n\n        </div>\n    </div>\n</div>';