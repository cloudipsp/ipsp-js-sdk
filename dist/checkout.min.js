!function(t){var e={},n={},i=function(t){if(!e[t])throw Error(["module is undefined",t].join(" "));return e[t]},r=function(t,n){if(!e[t])throw Error(["module is undefined",t].join(" "));return new e[t](n||{})},o=function(t,n){if(e[t])throw Error(["module already added",t].join(" "));e[t]=n};t.$checkout=function(t,e){return n[t]?n[t]:n[t]=r(t,e)},t.$checkout.get=function(t,e){return r(t,e)},t.$checkout.module=function(t){return i(t)},t.$checkout.proxy=function(t){return i(t).apply(this,Array.prototype.slice.call(arguments,1))},t.$checkout.add=function(t,e){return o(t,e),this},t.$checkout.scope=function(t,e){return o(t,e(this)),this}}(window||{}),$checkout.scope("Class",function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,n=function(){};return n.prototype={instance:function(t){return new this.constructor(t)},proxy:function(t){return t="string"==typeof t?this[t]:t,function(t,e){return function(){return e.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}}(this,t)}},n.extend=function(n,i){function r(){!t&&this.init&&this.init.apply(this,arguments)}var o,s,a=this.prototype;t=!0,s=new this,t=!1;for(o in n)n.hasOwnProperty(o)&&("function"==typeof a[o]&&"function"==typeof n[o]&&e.test(n[o])?s[o]=function(t,e){return function(){var n,i=this._super;return this._super=a[t],n=e.apply(this,arguments),this._super=i,n}}(o,n[o]):s[o]=n[o]);return r.prototype=s,r.prototype.name=i,r.prototype.constructor=r,r.extend=arguments.callee,r},n}),$checkout.scope("Utils",function(t){return t.module("Class").extend({getType:function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(t){return"object"===this.getType(t)},isPlainObject:function(t){return!!t&&"object"==typeof t&&t.constructor===Object},isFunction:function(t){return"function"===this.getType(t)},isRegexp:function(t){return"regexp"===this.getType(t)},isArguments:function(t){return"arguments"===this.getType(t)},isError:function(t){return"error"===this.getType(t)},isArray:function(t){return"array"===this.getType(t)},isDate:function(t){return"date"===this.getType(t)},isString:function(t){return"string"===this.getType(t)},isNumber:function(t){return"number"===this.getType(t)},isElement:function(t){return t&&1===t.nodeType},toArray:function(t){return[].slice.call(t)},querySelectorAll:function(t,e){return this.toArray((e||document).querySelectorAll(t))},querySelector:function(t,e){return(e||document).querySelector(t)},forEach:function(t,e,n){var i;for(i in t)t.hasOwnProperty(i)&&e.call(n||null,t[i],i)},map:function(t,e,n){var i,r,o=[];for(i in t)t.hasOwnProperty(i)&&void 0!==(r=e.call(n||null,t[i],i))&&(o[i]=r);return o},removeElement:function(t){t.parentNode.removeChild(t)},createElement:function(t){return document.createElement(t)},extend:function(t){return this.forEach(Array.prototype.slice.call(arguments,1),function(e){null!==e&&this.forEach(e,function(e,n){t[n]=e})},this),t}})}),$checkout.scope("Deferred",function(t){function e(t){return o.isArray(t)}function n(t){return o.isFunction(t)}function i(t,n){if(e(t))for(var i=0;i<t.length;i++)n(t[i]);else n(t)}function r(t){var s="pending",a=[],u=[],c=[],h=null,l={done:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"resolved"===s&&n[i].apply(this,h),a.push(n[i]);else"resolved"===s&&arguments[t].apply(this,h),a.push(arguments[t]);return this},fail:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"rejected"===s&&n[i].apply(this,h),u.push(n[i]);else"rejected"===s&&arguments[t].apply(this,h),u.push(arguments[t]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(o.isArray(arguments[t]))for(var e=arguments[t],n=0;n<e.length;n++)"pending"===s&&c.push(e[n]);else"pending"===s&&c.push(arguments[t]);return this},then:function(){return arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2]),this},promise:function(t){if(null===t)return l;for(var e in l)t[e]=l[e];return t},state:function(){return s},debug:function(){console.log("[debug]",a,u,s)},isRejected:function(){return"rejected"===s},isResolved:function(){return"resolved"===s},pipe:function(t,e){return r(function(n){i(t,function(t){"function"==typeof t?d.done(function(){var e=t.apply(this,arguments);e&&"function"==typeof e?e.promise().then(n.resolve,n.reject,n.notify):n.resolve(e)}):d.done(n.resolve)}),i(e,function(t){"function"==typeof t?d.fail(function(){var e=t.apply(this,arguments);e&&"function"==typeof e?e.promise().then(n.resolve,n.reject,n.notify):n.reject(e)}):d.fail(n.reject)})}).promise()}},d={resolveWith:function(t){if("pending"===s){s="resolved";for(var e=h=arguments.length>1?arguments[1]:[],n=0;n<a.length;n++)a[n].apply(t,e)}return this},rejectWith:function(t){if("pending"===s){s="rejected";for(var e=h=arguments.length>1?arguments[1]:[],n=0;n<u.length;n++)u[n].apply(t,e)}return this},notifyWith:function(t){if("pending"===s)for(var e=h=arguments.length>1?arguments[1]:[],n=0;n<c.length;n++)c[n].apply(t,e);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},p=l.promise(d);return n(t)&&t.apply(p,[p]),p}var o=t("Utils");return r}),$checkout.scope("Event",function(t){return t.module("Class").extend({init:function(){this.events={},this.empty=[]},on:function(t,e){return(this.events[t]=this.events[t]||[]).push(e),this},off:function(t,e){t||(this.events={});for(var n=this.events[t]||this.empty,i=n.length=e?n.length:0;i--;)e===n[i][0]&&n.splice(i,1);return this},trigger:function(t){for(var e,n=this.events[t]||this.empty,i=n.length>0?n.slice(0,n.length):n,r=0;e=i[r++];)e.apply(e,this.empty.slice.call(arguments,1));return this}})}),$checkout.scope("Module",function(t){return t.module("Class").extend({utils:t("Utils"),getListener:function(){return this._listener_||(this._listener_=t.get("Event")),this._listener_},on:function(t,e){return this.getListener().on(t,e),this},off:function(t,e){return this.getListener().off(t,e),this},trigger:function(){return this.getListener().trigger.apply(this.getListener(),arguments),this},each:function(t,e){this.utils.forEach(t,this.proxy(e))},addAttr:function(t,e){if(!this.utils.isElement(t))return!1;this.utils.forEach(e,function(e,n){t.setAttribute(n,e)})},addCss:function(t,e){if(!this.utils.isElement(t))return!1;this.utils.forEach(e,function(e,n){t.style[n]=e})},addEvent:function(t,e,n){if(!t||!e||!n)return!1;n=this.proxy(n),t.addEventListener?t.addEventListener(e,n):t.attachEvent&&t.attachEvent("on"+e,n)},removeEvent:function(t,e,n){if(!t||!e||!n)return!1;n=this.proxy(n),t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)},prepareForm:function(t,e,n,i){var r=this.utils.createElement("form");return this.addAttr(r,{action:t,target:n||"_self",method:i||"POST"}),this.addCss(r,{display:"none"}),this.utils.forEach(e,function(t,e,n){(n=this.utils.createElement("input")).type="hidden",n.name=e,n.value=t,r.appendChild(n)},this),r}})}),$checkout.scope("Connector",function(t){return t.module("Module").extend({ns:"crossDomain",origin:"*",uniqueId:1,init:function(t){this.setTarget(t.target),this.create()},create:function(){this.addEvent(window,"message","router")},setTarget:function(t){return this.target=t,this},getUID:function(){return++this.uniqueId},router:function(t,e,n){try{n=JSON.parse(e.data)}catch(t){}n.action&&n.data&&this.trigger(n.action,n.data)},send:function(t,e){this.target.postMessage(JSON.stringify({action:t,data:e}),this.origin,[])}})}),$checkout.scope("AcsFrame",function(t){return t.module("Module").extend({name:"acsframe",className:"ipsp-modal-iframe",attrs:{frameborder:"0",allowtransparency:"true",scrolling:"no"},styles:{overflowX:"hidden",border:"0",display:"block",width:"100%",height:"750px"},init:function(e){this.checkout=e.checkout,this.data=e.data,this.template=t.views["3ds.html"],this.initModal(),this.initEvents(),this.initFrame(),this.initConnector()},initModal:function(){this.modal=this.utils.createElement("div"),this.modal.innerHTML=this.template,this.utils.querySelector("body").appendChild(this.modal)},initFrame:function(){this.name=[this.name,Math.round(1e9*Math.random())].join(""),this.wrapper=this.find(".ipsp-modal-content"),this.iframe=this.utils.createElement("iframe"),this.addAttr(this.iframe,{id:this.id,name:this.name,class:this.className}),this.addAttr(this.iframe,this.attrs),this.addCss(this.iframe,this.styles),this.form=this.prepareForm(this.data.url,this.data.send_data,this.name),this.wrapper.appendChild(this.iframe),this.wrapper.appendChild(this.form),this.form.submit()},find:function(t){return this.utils.querySelector(t,this.modal)},initEvents:function(){var t=this.find(".ipsp-modal-close"),e=this.find(".ipsp-modal-title a");this.addEvent(t,"click","closeModal"),this.addEvent(e,"click","submitForm")},closeModal:function(t,e){e.preventDefault(),this.removeModal()},submitForm:function(t,e){e.preventDefault(),this.form.submit()},removeModal:function(){this.utils.removeElement(this.modal)},initConnector:function(){this.connector=t.get("Connector"),this.connector.on("response",this.proxy("onResponse"))},onResponse:function(t,e){this.connector.off("response"),this.checkout.connector.send("request",{uid:e.uid,action:"api.checkout.proxy",method:"send",params:e}),this.removeModal()}})}),$checkout.scope("Model",function(t){return t.module("Module").extend({init:function(t){this.data=t||{}},each:function(){var t,e=arguments,n=e[1]?e[0]:null,i=e[1]?e[1]:e[0],r=n?this.alt(n,[]):this.data;for(t in r)r.hasOwnProperty(t)&&i(this.instance(r[t]),r[t],t)},alt:function(t,e){return void 0===(t=this.attr(t))?e:t},attr:function(t,e){for(var n=0,i=this.data,r=(t||"").split("."),o=r.pop(),s=arguments.length;n<r.length;n++)if(i&&i.hasOwnProperty(r[n]))i=i[r[n]];else{if(2!==s)break;i=i[r[n]]={}}return 1===s?i?i[o]:void 0:(2===s&&(i[o]=e),this)},stringify:function(){return JSON.stringify(this.serialize())},serialize:function(){return this.data}})}),$checkout.scope("Response",function(t){return t.module("Model").extend({formDataSubmit:function(t,e,n,i){var r=this.prepareForm(t,e,n,i);this.utils.querySelector("body").appendChild(r),r.submit(),r.parentNode.removeChild(r)},needVerifyCode:function(){return this.attr("order.need_verify_code")},redirectUrl:function(){if(this.attr("url"))return location.assign(this.attr("url")),!0},submitForm:function(){var t=this.attr("method"),e=this.attr("url"),n=this.attr("send_data");return this.formDataSubmit(e,n,"_top",t),!0},sendResponse:function(){var t=this.attr("action");return"submit"===t?this.submitForm():"redirect"===t&&this.redirectUrl()}})}),$checkout.scope("FormData",function(t){return t.module("Module").extend({init:function(t){this.setFormElement(t)},setFormElement:function(t){this.utils.isElement(t)&&(this.form=t)},getData:function(t){var e=this.deparam(this.serializeArray());return 1==t?this.clean(e):e},clean:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(0===t[e].length?(this.utils.isArray(t)&&t.splice(e,1),this.utils.isPlainObject(t)&&delete t[e]):this.utils.isPlainObject(t[e])&&this.clean(t[e]));return t},serializeArray:function(){var t=this.utils.toArray(this.form.elements);return this.utils.map(t,function(t){if(!t.disabled&&""!==t.name&&(!t.type.match("checkbox|radio")||t.checked))return{name:t.name,value:t.value}})},serializeAndEncode:function(){return this.utils.map(this.serializeArray(),function(t){return[t.name,encodeURIComponent(t.value)].join("=")}).join("&")},deparam:function(t){var e,n={},i=/[^\[\]]+|\[\]$/g;for(e in t)t.hasOwnProperty(e)&&function(t,e){var i,r=n,o=t.pop(),s=t.length;for(i=0;i<s;i++)r[t[i]]||(r[t[i]]=s==i+1&&"[]"==o?[]:{}),r=r[t[i]];"[]"==o?r.push(e):r[o]=e}(t[e].name.match(i),t[e].value);return n}})}),$checkout.scope("Api",function(t){return t.module("Module").extend({origin:"https://api.fondy.eu",endpoint:{gateway:"/checkout/v2/"},init:function(){this.loaded=!1,this.created=!1,this.connector=t.get("Connector")},setOrigin:function(t){return this.origin=t,this},url:function(t,e){return[this.origin,this.endpoint[t]||"/",e||""].join("")},loadFrame:function(t){return this.iframe=this.utils.createElement("iframe"),this.addAttr(this.iframe,{src:t}),this.addCss(this.iframe,{display:"none"}),this.utils.querySelector("body").appendChild(this.iframe),this.iframe},create:function(){return!1===this.created&&(this.created=!0,this.iframe=this.loadFrame(this.url("gateway")),this.connector.setTarget(this.iframe.contentWindow),this.connector.on("load",this.proxy("load")),this.connector.on("form3ds",this.proxy("form3ds"))),this},form3ds:function(e,n){this.acsframe=t.get("AcsFrame",{checkout:this,data:n})},load:function(){this.loaded=!0,this.trigger("checkout.api"),this.off("checkout.api")},scope:function(t){t=this.proxy(t),!0===this.create().loaded?t():this.on("checkout.api",t)},request:function(e,n,i){var r=t.get("Deferred"),o={uid:this.connector.getUID(),action:e,method:n,params:i||{}};return this.connector.send("request",o),this.connector.on(o.uid,this.proxy(function(e,n){r[n.error?"rejectWith":"resolveWith"](this,[t.get("Response",n)])})),r}})}),$checkout.scope("Widget",function(t){return t.module("Api").extend({init:function(t){this._super(t),this.params=t,this.initWidget()},initWidget:function(){this.initOptions(this.params.options),this.utils.isString(this.params.element)&&this.initElement(this.params.element),this.utils.isString(this.params.origin)&&this.setOrigin(this.params.origin)},initOptions:function(){this.utils.isPlainObject(this.params.options)&&(this.params.options=this.params.options||{})},initElement:function(t){},addSelectorEvent:function(t,e,n){return this.each(this.utils.querySelectorAll(t),function(t,i){this.addEvent(i,e,n)}),this},getRequestParams:function(){return{}},sendRequest:function(t,e){e.preventDefault(),this.scope(function(){this.request("api.checkout.form","request",this.getRequestParams(t)).done(this.proxy("onSuccess")).fail(this.proxy("onError"))})},onSuccess:function(t,e){e.sendResponse(),this.trigger("success",e)},onError:function(t,e){this.trigger("error",e)}})}),$checkout.scope("FormWidget",function(t){return t.module("Widget").extend({initElement:function(t){this.addSelectorEvent(t,"submit","sendRequest")},getRequestParams:function(e){return this.utils.extend({},this.params.options,t.get("FormData",e).getData())}})}),$checkout.scope("ButtonWidget",function(t){return t.module("Widget").extend({attributes:{},initElement:function(t){this.utils.isPlainObject(this.params.attributes)&&this.utils.extend(this.attributes,this.params.attributes),this.addSelectorEvent(t,"click","sendRequest")},getRequestParams:function(t){return this.utils.extend({},this.params.options,this.getElementData(t))},getElementData:function(t){var e={};return this.utils.forEach(this.attributes,function(n,i){t.hasAttribute(i)&&(e[n]=t.getAttribute(i))}),e}})}),function(t){"use strict";$checkout.views=Object.create(null),$checkout.views["3ds.html"]='<style>\n    .ipsp-modal-show{\n        overflow:hidden;\n    }\n    .ipsp-modal{\n        margin:100px auto;\n        max-width:680px;\n        background-color:#fff;\n        border-radius:5px;\n        box-shadow:0px 2px 2px rgba(0,0,0,0.2);\n        overflow: hidden;\n    }\n    @media (max-width:850px){\n        .ipsp-modal{\n            margin:50px auto;\n        }\n    }\n    @media (max-width:695px){\n        .ipsp-modal{\n            max-width:100%;\n            margin:5px;\n        }\n    }\n    .ipsp-modal-wrapper{\n        overflow: auto;\n        position:fixed;\n        z-index:99999;\n        left:0;\n        bottom:0;\n        top:0;\n        right:0;\n        background-color: rgba(0,0,0,0.2);\n    }\n    .ipsp-modal-header{\n        background-color:#fafafa;\n        height:50px;\n        box-shadow:0px 0px 2px rgba(0,0,0,0.2);\n        border-top-left-radius:5px;\n        border-top-right-radius:5px;\n    }\n    .ipsp-modal-close{\n        float:right;\n        overflow:hidden;\n        height:50px;\n        text-decoration:none;\n        border-top-right-radius:5px;\n        color:#949494;\n    }\n    .ipsp-modal-close:hover,.ipsp-modal-close:focus,.ipsp-modal-close:active{\n        text-decoration:none;\n        color:#646464;\n    }\n    .ipsp-modal-close:before{\n        content:"×";\n        font-size:50px;\n        line-height:50px;\n        padding:0 10px;\n    }\n    .ipsp-modal-title{\n        border-top-left-radius:5px;\n        line-height:20px;\n        height:50px;\n        padding:5px 15px;\n        font-size:12px;\n        display:table-cell;\n        vertical-align: middle;\n    }\n    .ipsp-modal-content{\n        border-bottom-left-radius:5px;\n        border-bottom-left-radius:5px;\n        min-height:650px;\n    }\n</style>\n<div class="ipsp-modal-wrapper">\n    <div class="ipsp-modal">\n        <div class="ipsp-modal-header">\n            <a href="#" class="ipsp-modal-close"></a>\n            <div class="ipsp-modal-title">\n                Now you will be redirected to your bank 3DSecure.\n                If you are not redirected please refer\n                <a href=\'javascript:void(0)\'>link</a>\n            </div>\n        </div>\n        <div class="ipsp-modal-content"></div>\n    </div>\n</div>'}(jQuery);