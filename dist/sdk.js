(function(){var t="1.0.0",e={},n={};this.$checkout=function(t,e){return n[t]?n[t]:n[t]=arguments.callee.get(t,e||{})},this.$checkout.get=function(t,n){if(!e[t])throw Error("module is undefined");return new e[t](n||{})},this.$checkout.module=function(t){if(!e[t])throw Error("module is undefined");return e[t]},this.$checkout.add=function(t,n){if(e[t])throw Error("module already added");e[t]=n},this.$checkout.version=function(e){return t=e,this},this.$checkout._debug_=Number(document.cookie.replace(/(?:(?:^|.*;\s*)checkout_debug\s*\=\s*([^;]*).*$)|^.*$/,"$1")),this.$checkout.debug=function(t){document.cookie=["checkout_debug",Number(t)].join("=")},this.$checkout.log=function(){this._debug_&&"console"in window&&console.log.apply(console,arguments)},this.$checkout.factory=function(t,e){this.add(t,e(this))}}).call(window||{}),function(){var t=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};this.isObject=function(e){return"object"===t(e)},this.isFunction=function(e){return"function"===t(e)},this.isRegexp=function(e){return"regexp"===t(e)},this.isArguments=function(e){return"arguments"===t(e)},this.isError=function(e){return"error"===t(e)},this.isArray=function(e){return"array"===t(e)},this.isDate=function(e){return"date"===t(e)},this.isString=function(e){return"string"===t(e)},this.isNumber=function(e){return"number"===t(e)},this.isBoolean=function(e){return"boolean"===t(e)},this.isElement=function(t){return t&&1===t.nodeType},this.getType=t}.call(window||{}),function(){this.removeElement=function(t){t.parentNode.removeChild(t)}}(),function(){this.addEvent=function(t,e,n){if(!t)return!1;t.addEventListener?t.addEventListener(e,n):t.attachEvent&&t.attachEvent("on"+e,n)}}(),$checkout.factory("popupBlocker",function(t){return function(t){var e=!1;try{e=void 0===t||(!t||!t.closed)&&(!t||!t.test)}catch(t){}return e}}),$checkout.factory("Class",function(t){var e=!1,n=/xyz/.test(function(){return"xyz"}.toString())?/\b_super\b/:/.*/,i=function(){};return i.prototype={instance:function(t){return new this.constructor(t)},proxy:function(t){return t="string"==typeof t?this[t]:t,function(t,e){return function(){return e.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}}(this,t)}},i.extend=function(t,i){function r(){!e&&this.init&&this.init.apply(this,arguments)}var o,s,c=this.prototype;e=!0,s=new this,e=!1;for(o in t)t.hasOwnProperty(o)&&("function"==typeof c[o]&&"function"==typeof t[o]&&n.test(t[o])?s[o]=function(t,e){return function(){var n,i=this._super;return this._super=c[t],n=e.apply(this,arguments),this._super=i,n}}(o,t[o]):s[o]=t[o]);return r.prototype=s,r.prototype.name=i,r.prototype.constructor=r,r.extend=arguments.callee,r},i}),$checkout.factory("Deferred",function(t){function e(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t,n){if(e(t))for(var i=0;i<t.length;i++)n(t[i]);else n(t)}function i(t){var r="pending",o=[],s=[],c=[],u=null,h={done:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"resolved"===r&&n[i].apply(this,u),o.push(n[i]);else"resolved"===r&&arguments[t].apply(this,u),o.push(arguments[t]);return this},fail:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"rejected"===r&&n[i].apply(this,u),s.push(n[i]);else"rejected"===r&&arguments[t].apply(this,u),s.push(arguments[t]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var t=0;t<arguments.length;t++)if(arguments[t])if(e(arguments[t]))for(var n=arguments[t],i=0;i<n.length;i++)"pending"===r&&c.push(n[i]);else"pending"===r&&c.push(arguments[t]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(t){if(null===t)return h;for(var e in h)t[e]=h[e];return t},state:function(){return r},debug:function(){console.log("[debug]",o,s,r)},isRejected:function(){return"rejected"===r},isResolved:function(){return"resolved"===r},pipe:function(t,e,r){return i(function(i){n(t,function(t){"function"==typeof t?a.done(function(){var e=t.apply(this,arguments);e&&"function"==typeof e?e.promise().then(i.resolve,i.reject,i.notify):i.resolve(e)}):a.done(i.resolve)}),n(e,function(t){"function"==typeof t?a.fail(function(){var e=t.apply(this,arguments);e&&"function"==typeof e?e.promise().then(i.resolve,i.reject,i.notify):i.reject(e)}):a.fail(i.reject)})}).promise()}},a={resolveWith:function(t){if("pending"===r){r="resolved";for(var e=u=arguments.length>1?arguments[1]:[],n=0;n<o.length;n++)o[n].apply(t,e)}return this},rejectWith:function(t){if("pending"===r){r="rejected";for(var e=u=arguments.length>1?arguments[1]:[],n=0;n<s.length;n++)s[n].apply(t,e)}return this},notifyWith:function(t){if("pending"===r)for(var e=u=arguments.length>1?arguments[1]:[],n=0;n<c.length;n++)c[n].apply(t,e);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},f=h.promise(a);return isFunction(t)&&t.apply(f,[f]),f}return i.when=function(){if(arguments.length<2){var t=arguments.length?arguments[0]:void 0;return t&&"function"==typeof t.isResolved&&"function"==typeof t.isRejected?t.promise():i().resolve(t).promise()}return function(t){for(var e=i(),n=t.length,r=0,o=new Array(n),s=0;s<t.length;s++)!function(i){var s=null;t[i].done?t[i].done(function(){o[i]=arguments.length<2?arguments[0]:arguments,++r==n&&e.resolve.apply(e,o)}).fail(function(){e.reject(arguments)}):(s=t[i],t[i]=new Deferred,t[i].done(function(){o[i]=arguments.length<2?arguments[0]:arguments,++r==n&&e.resolve.apply(e,o)}).fail(function(){e.reject(arguments)}).resolve(s))}(s);return e.promise()}(arguments)},i}),$checkout.factory("Event",function(t){return t.module("Class").extend({init:function(){this.events={},this.empty=[]},on:function(t,e){return(this.events[t]=this.events[t]||[]).push(e),this},off:function(t,e){t||(this.events={});for(var n=this.events[t]||this.empty,i=n.length=e?n.length:0;i--;)e===n[i][0]&&n.splice(i,1);return this},trigger:function(t){for(var e,n=this.events[t]||this.empty,i=n.length>0?n.slice(0,n.length):n,r=0;e=i[r++];)e.apply(e,this.empty.slice.call(arguments,1));return this}})}),$checkout.factory("Connector",function(t){return t.module("Class").extend({ns:"crossDomain",origin:"*",uniqueId:1,init:function(t){this.setTarget(t.target),this.create()},create:function(){this.listener=t.get("Event"),addEvent(window,"message",this.proxy("router"))},setTarget:function(t){return this.target=t,this},getUID:function(){return++this.uniqueId},unbind:function(t,e){this.listener.off([this.ns,t].join("."),e)},action:function(t,e){this.listener.on([this.ns,t].join("."),e)},publish:function(t,e){this.listener.trigger([this.ns,t].join("."),e)},router:function(t,e,n){try{n=JSON.parse(e.data)}catch(t){}n.action&&n.data&&this.publish(n.action,n.data)},send:function(t,e){this.target.postMessage(JSON.stringify({action:t,data:e}),this.origin,[])}})}),$checkout.factory("Api",function(t){return t.module("Class").extend({origin:"https://api.dev.fondy.eu",endpoint:{gateway:"/checkout/"},init:function(){this.loaded=!1,this.created=!1,this.listener=t.get("Event"),this.connector=t.get("Connector"),this.params={}},url:function(t,e){return[this.origin,this.endpoint[t]||"/",e||""].join("")},loadFrame:function(t){return this.iframe=document.createElement("iframe"),this.iframe.src=t,this.iframe.style.display="none",document.getElementsByTagName("body")[0].appendChild(this.iframe),this.iframe},create:function(){return!1===this.created&&(this.created=!0,this.iframe=this.loadFrame(this.url("gateway")),this.connector.setTarget(this.iframe.contentWindow),this.connector.action("load",this.proxy("load")),this.connector.action("form3ds",this.proxy("form3ds"))),this},form3ds:function(e,n){this.acsframe=t.get("AcsFrame",{checkout:this,data:n})},load:function(){this.loaded=!0,this.listener.trigger("checkout.api"),this.listener.off("checkout.api")},scope:function(t){t=this.proxy(t),!0===this.create().loaded?t():this.listener.on("checkout.api",t)},defer:function(){return t.get("Deferred")},request:function(t,e,n){var i=this.defer(),r={};return r.uid=this.connector.getUID(),r.action=t,r.method=e,r.params=n||{},this.connector.send("request",r),this.connector.action(r.uid,this.proxy(function(t,e){i[e.error?"rejectWith":"resolveWith"](this,[e])},this)),i}})}),$checkout.factory("StyleSheet",function(t){return t.module("Class").extend({init:function(){this.element=document.createElement("style"),this.element.type="text/css"},append:function(t){t.appendChild(this.element)},value:function(t){if(style.styleSheet&&!style.sheet)style.styleSheet.cssText=t;else try{style.innerHTML="",style.appendChild(document.createTextNode(t))}catch(e){style.innerHTML=t}}})}),$checkout.factory("AcsFrame",function(t){return t.module("Class").extend({name:"acsframe",attrs:{frameborder:"0",allowtransparency:"true",scrolling:"no"},styles:{zIndex:"9999",overflowX:"hidden",border:"0",display:"block",top:"0px",left:"0px",bottom:"0px",right:"0px",width:"100%",height:"750px"},init:function(t){this.checkout=t.checkout,this.data=t.data,this.initModal(),this.initFrame(),this.initConnector()},initFrame:function(){this.name=[this.name,Math.round(1e9*Math.random())].join(""),this.wrapper=document.createElement("div"),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("name",this.name),this.iframe.setAttribute("id",this.name),this.iframe.className="ipsp-modal-iframe",this.addAttr(this.iframe,this.attrs),this.addCss(this.iframe,this.styles),this.form=this.prepareForm(this.data.url,this.data.send_data,this.name),this.wrapper.appendChild(this.iframe),this.wrapper.appendChild(this.form),this.modal.appendChild(this.wrapper),this.form.submit()},initModal:function(){this.modal=document.createElement("div"),this.modal.className="ipsp-modal",this.addCss(this.modal,{position:"absolute",top:"100px",left:"50%","margin-left":"-340px",width:"680px","z-index":"999999","border-radius":"5px","box-shadow":"0 1px 5px rgba(0,0,0, 0.3)",height:"720px"}),document.querySelector("body").appendChild(this.modal)},prepareForm:function(t,e,n,i){var r,o=document.createElement("form");o.action=t,o.target=n||"_self",o.method=i||"POST";for(var s in e)e.hasOwnProperty(s)&&((r=document.createElement("input")).type="hidden",r.name=s,r.value=e[s],o.appendChild(r));return o.style.display="none",o},initConnector:function(){this.connector=t.get("Connector"),this.connector.action("response",this.proxy(function(t,e){this.connector.unbind("response"),this.checkout.connector.send("request",{uid:e.uid,action:"api.checkout.proxy",method:"send",params:e}),removeElement(this.modal)},this))},addCss:function(t,e){if(!t)return!1;for(var n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},addAttr:function(t,e){var n;if(!t)return!1;for(n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])}})});